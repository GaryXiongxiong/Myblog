<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Spring Cloud Stream 配合Kafka 基础使用demo · 蒋亦雄的博客</title><meta name="description" content="Spring Cloud Stream 配合Kafka 基础使用demo - Yixiong Jiang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://jiangyixiong.top/atom.xml" title="蒋亦雄的博客"><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="蒋亦雄的博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/categories/blog" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/categories/podcast" target="_self" class="nav-list-link">PODCAST</a></li><li class="nav-list-item"><a href="https://github.com/GaryXiongxiong" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/resume/" target="_self" class="nav-list-link">RESUME</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Spring Cloud Stream 配合Kafka 基础使用demo</h1><div class="post-info">2020年9月8日</div><div class="post-content"><h2 id="简介与概念"><a href="#简介与概念" class="headerlink" title="简介与概念"></a>简介与概念</h2><p>Spring Cloud Stream 是一个用于构建消息驱动微服务的框架。Spring Cloud Stream 基于 Spring Boot，整合消息中间件（Kafka或RabbitMQ） 构建可独立运行，生产级的Spring应用。</p>
<h4 id="应用模型"><a href="#应用模型" class="headerlink" title="应用模型"></a>应用模型</h4><p>一个<strong>Spring Cloud Stream</strong>应用程序依赖于于独立的消息中间件。应用通过<strong>Spring Cloud Stream</strong>注入的输入和输出<em>通道</em>与外部世界通信。通道通过专用的<em>Binder</em>实现与外部代理连接。这种模型屏蔽了消息中间件的使用差异，我们只需掌握Spring Cloud Stream的使用就可以方便的构建消息驱动的微服务应用。</p>
<p><img src="/images/spring-cloud-stream-model.png" alt="Spring Cloud Stream引用模型"></p>
<h4 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h4><p>Binder 是 Spring Cloud Stream 的一个抽象概念，是应用与消息中间件之间的粘合剂。目前 Spring Cloud Stream 实现了 Kafka 和 Rabbit MQ 的binder。</p>
<p>通过 binder ，可以很方便的连接中间件，可以动态的改变消息的<br> destinations（对应于 Kafka 的topic，Rabbit MQ 的 exchanges），这些都可以通过<code>spring.cloud.stream.binder</code>进行配置。</p>
<h4 id="发布订阅模型"><a href="#发布订阅模型" class="headerlink" title="发布订阅模型"></a>发布订阅模型</h4><p>Spring Cloud Stream 使用了经典的发布/订阅模式。发布者将消息发布到指定的Topic中，订阅者通过订阅该Topic来消费消息。</p>
<h4 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a>Consumer Group</h4><p>类似于Kafka中消费者组的概念，每个binding可以指定一个group，一条消息只会被同一个group中的一个binding消费。可以被用来防止重复消费。可以于<code>spring.cloud.stream.bindings.&lt;channelName&gt;.group</code>中定义。</p>
<h2 id="搭建Kafka与Zookeeper"><a href="#搭建Kafka与Zookeeper" class="headerlink" title="搭建Kafka与Zookeeper"></a>搭建Kafka与Zookeeper</h2><p>为了在本地构建我们的第一个Spring Cloud Stream应用，我们需要先行搭建其依赖的Kafka。Kafka又需要用到Zookeeper。这里使用Docker Compose来快速搭建Kafka与Zookeeper。</p>
<h4 id="编写-Docker-compose-yml"><a href="#编写-Docker-compose-yml" class="headerlink" title="编写 Docker-compose.yml"></a>编写 <code>Docker-compose.yml</code></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wurstmeister/kafka</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka-streamlistener</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9092:9092&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ADVERTISED_HOST_NAME=192.168.99.100</span> <span class="comment">#这里写docker宿主机地址。此例为在windows Docker Quickstart中运行，故地址为docker所在虚拟机的地址。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ADVERTISED_PORT=9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wurstmeister/zookeeper</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2181:2181&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_ADVERTISED_HOST_NAME=zookeeper</span></span><br><span class="line">  <span class="attr">kafka-manager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sheepkiller/kafka-manager</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9000</span><span class="string">:9000</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ZK_HOSTS:</span> <span class="string">zookeeper:2181</span></span><br><span class="line">      <span class="attr">KAFKA_BROKERS:</span> <span class="string">kafka:9092</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="启动配置好的Docker-compose"><a href="#启动配置好的Docker-compose" class="headerlink" title="启动配置好的Docker-compose"></a>启动配置好的Docker-compose</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>之后前往 <code>http://192.168.99.100:9000</code>验证 Kafka 运行情况</p>
<h2 id="构建-Spring-Cloud-Stream-应用"><a href="#构建-Spring-Cloud-Stream-应用" class="headerlink" title="构建 Spring Cloud Stream 应用"></a>构建 Spring Cloud Stream 应用</h2><p>本例中，我们将构建两个微服务，<code>Producer</code>开放Restful接口，并将接口请求发布至消息队列。<code>Sample</code>订阅队列并打印其中的消息。</p>
<h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><p>首先在两个项目中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream-test-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="在-Spring-Boot-中配置-Spring-Cloud-Stream-的-binder-与-bindings"><a href="#在-Spring-Boot-中配置-Spring-Cloud-Stream-的-binder-与-bindings" class="headerlink" title="在 Spring Boot 中配置 Spring Cloud Stream 的 binder 与 bindings"></a>在 Spring Boot 中配置 Spring Cloud Stream 的 binder 与 bindings</h4><p>Consumer的<code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="comment"># Kafka节点地址列表</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">192.168</span><span class="number">.99</span><span class="number">.100</span><span class="string">:9092</span></span><br><span class="line">      <span class="attr">default-binder:</span> <span class="string">kafka</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="comment"># 设置binding</span></span><br><span class="line">        <span class="attr">msg_output:</span></span><br><span class="line">          <span class="comment"># 对应kafka的topic名称</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">msg</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">kafka</span></span><br><span class="line">        <span class="comment"># 可以设置多个binding，对应不同或相同的destination，如果destination相同且未设置group，将会重复消费对应destination中的消息。若group相同将会采用竞争策略，只有一个binding可以消费消息</span></span><br><span class="line">        <span class="attr">error_output:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">error</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">kafka</span></span><br></pre></td></tr></table></figure>

<p>Consumer的<code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">192.168</span><span class="number">.99</span><span class="number">.100</span><span class="string">:9092</span></span><br><span class="line">      <span class="attr">default-binder:</span> <span class="string">kafka</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">msg_input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">msg</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">kafka</span></span><br><span class="line">        <span class="attr">error_input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">error</span></span><br><span class="line">          <span class="attr">binder:</span> <span class="string">kafka</span></span><br></pre></td></tr></table></figure>

<h4 id="Producer编写"><a href="#Producer编写" class="headerlink" title="Producer编写"></a><code>Producer</code>编写</h4><p>定义binding接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义通道名称</span></span><br><span class="line">    String OUTPUT_CHANNEL =<span class="string">&quot;msg_output&quot;</span>;</span><br><span class="line">    String ERROR_CHANNEL =<span class="string">&quot;error_output&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过Output注解定义输出通道</span></span><br><span class="line">    <span class="meta">@Output(Producer.OUTPUT_CHANNEL)</span></span><br><span class="line">    <span class="function">MessageChannel <span class="title">messageOutput</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Output(Producer.ERROR_CHANNEL)</span></span><br><span class="line">    <span class="function">MessageChannel <span class="title">errorOutput</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开启<code>binding</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableBinding(Producer.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamproducerApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(StreamproducerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义Controller接收请求并置入消息队列</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/msg/&#123;key&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String key, <span class="meta">@RequestBody</span> Object msg)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; payload = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        payload.put(key,msg);</span><br><span class="line">        <span class="comment">//将负载送入通道</span></span><br><span class="line">        producer.messageOutput().send(MessageBuilder.withPayload(payload).build());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sent&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/error/&#123;key&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sendErr</span><span class="params">(<span class="meta">@PathVariable</span> String key, <span class="meta">@RequestBody</span> Object err)</span></span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; payload = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        payload.put(key,err);</span><br><span class="line">        producer.errorOutput().send(MessageBuilder.withPayload(payload).build());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sent&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Consumer编写"><a href="#Consumer编写" class="headerlink" title="Consumer编写"></a><code>Consumer</code>编写</h4><p>定义binding接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    String INPUT_CHANNEL =<span class="string">&quot;msg_input&quot;</span>;</span><br><span class="line">    String ERROR_CHANNEL =<span class="string">&quot;error_input&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input(Consumer.INPUT_CHANNEL)</span></span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">messageInput</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input(Consumer.ERROR_CHANNEL)</span></span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">errorInput</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>@StreamListener</code>注解消费消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableBinding(Consumer.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@StreamListener(Consumer.INPUT_CHANNEL)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getInput</span><span class="params">(Map&lt;String,Object&gt; msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[msg]: &quot;</span>+msg.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@StreamListener(Consumer.ERROR_CHANNEL)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getError</span><span class="params">(Map&lt;String,Object&gt; error)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[err]: &quot;</span>+error.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p>Producer请求</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>:<span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;uid&quot;</span>:<span class="string">&quot;3319&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>:<span class="string">&quot;ERROR&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;uid&quot;</span>:<span class="string">&quot;2113&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Consumer输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[msg]: &#123;msg1&#x3D;&#123;msg&#x3D;hello, uid&#x3D;3319&#125;&#125;</span><br><span class="line">[err]: &#123;error1&#x3D;&#123;error&#x3D;ERROR, uid&#x3D;2113&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32734365/article/details/81413218">Spring Cloud Stream中文指导手册</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-stream/3.0.6.RELEASE/reference/html/spring-cloud-stream.html#_quick_start">Spring Cloud Stream - Quick Start</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fb7d11c7f798">使用 Spring Cloud Stream 构建消息驱动微服务</a></li>
</ul>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2020/09/08/Elastic%20Search%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80-Docker%E5%AE%89%E8%A3%85Elastic-Search%E5%B9%B6%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/" class="prev">PREV</a><a href="/2020/09/07/Spring-Cloud-OpenFeign-%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="next">NEXT</a></div><div class="copyright"><p><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv">页面访问量:<span id="busuanzi_value_page_pv"></span></span></p><p>© 2018 - 2021 <a href="http://jiangyixiong.top">Yixiong Jiang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>